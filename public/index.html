<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>iClock</title>
  <style>
    body {
      background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAAECAYAAACp8Z5+AAAAAXNSR0IArs4c6QAAABJJREFUCB1jYGBg+A/ExAHsKgFV7gH/ssPq5wAAAABJRU5ErkJggg==) repeat;
    }

    .clock {
      width: 400px;
      height: 400px;
      stroke: black;
      stroke-linecap: round;
      fill: #4aa2ef;
    }

    .dial {
      stroke-width: 0.5;
      stroke: #fff;
    }
    .ticks {
      stroke-width: 1;
    }
    .hour, .min, .sec {
      stroke-width: 1;
      fill: #333;
      stroke: #555;
    }
    .sec {
      stroke: #f55;
    }
  </style>
</head>
<body>
  <svg id="three" class="clock" viewBox="0 0 100 100">
    <circle class="dial" cx="50" cy="50" r="45" />

    <g class="ticks">
      <line class="_12_" x1="50" y1="5.000" x2="50.00" y2="10.00" />
      <line class="_1_" x1="72.50" y1="11.03" x2="70.00" y2="15.36" />
      <line class="_2_" x1="88.97" y1="27.50" x2="84.64" y2="30.00" />
      <line class="_3_" x1="95.00" y1="50.00" x2="90.00" y2="50.00" />
      <line class="_4_" x1="88.97" y1="72.50" x2="84.64" y2="70.00" />
      <line class="_5_" x1="72.50" y1="88.97" x2="70.00" y2="84.64" />
      <line class="_6_" x1="50.00" y1="95.00" x2="50.00" y2="90.00" />
      <line class="_7_" x1="27.50" y1="88.97" x2="30.00" y2="84.64" />
      <line class="_8_" x1="11.03" y1="72.50" x2="15.36" y2="70.00" />
      <line class="_9_" x1="5.000" y1="50.00" x2="10.00" y2="50.00" />
      <line class="_10_" x1="11.03" y1="27.50" x2="15.36" y2="30.00" />
      <line class="_11_" x1="27.50" y1="11.03" x2="30.00" y2="15.36" />
    </g>

    <g class="hands">
      <rect class="hour" x="48.5" y="12.5" width="5" height="40" rx="2.5" ry="2.55" />
      <rect class="min" x="48" y="12.5" width="3" height="40" rx="2" ry="2"/>
      <line class="sec" x1="50" y1="50" x2="50" y2="16" />
    </g>
  </svg>

  <svg id="two" class="clock" viewBox="0 0 100 100">
    <circle class="dial" cx="50" cy="50" r="45"/>
    <g class="hands">
      <rect class="hour" x="48.5" y="12.5" width="5" height="40" rx="2.5" ry="2.55" />
      <rect class="min" x="48" y="12.5" width="3" height="40" rx="2" ry="2" />
    </g>
  </svg>

  <svg id="one" class="clock" viewBox="0 0 100 100">
    <circle class="dial" cx="50" cy="50" r="45" />
    <line class="hour" x1="50" y1="50" x2="50" y2="16" />
  </svg>

  <h3>References</h3>

  <ul>
    <li>http://thenewcode.com/943/An-SVG-Analog-Clock-In-6-Lines-of-JavaScript</li>
    <li>https://gist.github.com/janx/1188550</li>
    <li>https://jsfiddle.net/MrPolywhirl/znene4g5/</li>
  </ul>

  <script>
    var iClock = {
      state: {},

      register: function(proto) {
        if (this.hasOwnProperty(proto.name)) {
          throw("Error: name clash, "+proto.name+" already defined");
        }
        iClock[proto.name] = proto;
      },

      start: function() {
        var movement = new iClock.Movement;
        new iClock.Clock('#one', 1, movement);
        new iClock.Clock('#two', 2, movement);
        new iClock.Clock('#three', 3, movement);
        movement.start();
        this.state.movement = movement;
      }
    };

    iClock.register(
      /*
      sin(theta) = (y-50)/50
      cos(theta) = (x-50)/50

      hour  tick  theta (degree)
      12    60    -90
      1     5     -60
      2     10    -30
      3     15    0
      4     20    30
      5     25    60
      6     30    90
      7     35    120
      8     40    150
      9     45    180
      10    50    -150
      11    55    -120
      */
      function Dial() {
      }
    );

    iClock.register(
      function Movement(epoch, tock, undef) {
        this.engine = undef;

        this.epoch = (epoch || Date.now());
        this.time = new Date;

        this.clocks = [];
        this.power = function(clock) {
          this.clocks.push(clock);
        }

        this.tock = (tock || 1000);
        this.tick = function(tock) {
          this.epoch += (tock || this.tock);
          this.time.setTime(this.epoch);
          return this.time;
        }

        this.start = function() {
          this.engine = setInterval(
              function(self) {
                var time = self.tick();
                var clock;

                for (clock of self.clocks) {
                  clock['update'].call(clock, time);
                }
              },
              this.tock,
              this
          );
          return this.engine;
        };
        this.stop = function() {
          clearInterval(this.engine);
        };
      }
    );

    iClock.register(
      function Clock(el, handCount, movement, undef) {
        var tool = {
          $: function(sel, node) {
            return (node || document).querySelector(sel);
          },
          rotate: function(el, deg) {
            if (el && deg) {
              el.setAttribute('transform', 'rotate('+deg+' 50 50)');
            }
          }
        };

        this.el = {
          clock: undef,
          hands: {
            hour: undef,
            minute: undef,
            second: undef,
          }
        };
        this.el.clock = (function(el, t) {
          var type = typeof el;
          if (type === "string") {
            return t.$(el);
          } else if (type === "object") {
            return el;
          }
        })(el, tool);
        this.el.hands.hour = tool.$(".hour", this.el.clock);
        this.el.hands.minute = tool.$(".min", this.el.clock);
        this.el.hands.second = tool.$(".sec", this.el.clock);

        this.update = function(time) {
          if (this.el.hands.second) {
            tool.rotate(this.el.hands.second, 6*time.getSeconds());
            tool.rotate(this.el.hands.minute, 6*time.getMinutes());
            tool.rotate(this.el.hands.hour, 30*(time.getHours()%12) + time.getMinutes()/2);
          } else if (this.el.hands.minute) {
          } else if (this.el.hands.hour) {
          }
        }

        this.movement = movement;
        this.movement.power(this);
      }
    );

    iClock.start();
  </script>
</body>
</html>
